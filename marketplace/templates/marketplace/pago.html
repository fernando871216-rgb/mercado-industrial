{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card p-4 shadow-sm border-0">
                <h3 class="fw-bold mb-4">Resumen de tu compra</h3>
                
                <div class="d-flex align-items-center mb-4">
                    {% if producto.image %}
                        <img src="{{ producto.image.url }}" width="120" class="img-fluid rounded shadow-sm" alt="{{ producto.title }}">
                    {% endif %}
                    <div class="ms-4">
                        <h5 class="fw-bold">{{ producto.title }}</h5>
                        <p class="text-muted mb-0">Precio base: ${{ producto.price }} MXN</p>
                        <small class="text-primary">Vendedor verificado</small>
                    </div>
                </div>
                
                <hr>
                
                <h5 class="fw-bold mb-3">Método de entrega</h5>
                <div class="list-group">
                    <label class="list-group-item d-flex gap-3 py-3 shadow-sm mb-2 rounded border">
                        <input class="form-check-input flex-shrink-0" type="radio" name="envio" id="recoger" value="0" checked onchange="actualizarPreferencia(0)">
                        <span>
                            <strong class="d-block">Recoger en sucursal</strong>
                            <small class="text-muted">Gratis - El vendedor te contactará con la ubicación.</small>
                        </span>
                    </label>

                    <label class="list-group-item d-flex gap-3 py-3 shadow-sm rounded border">
                        <input class="form-check-input flex-shrink-0" type="radio" name="envio" id="soloenvios" value="150" onchange="actualizarPreferencia(150)">
                        <span>
                            <strong class="d-block">Envío a domicilio (SoloEnvios)</strong>
                            <small class="text-muted">Costo estimado: $150.00 MXN (Sujeto a confirmación según zona).</small>
                        </span>
                    </label>
                </div>
                
                <div class="alert alert-info mt-4 border-0 bg-light">
                    <small><i class="fas fa-info-circle"></i> El precio total incluye la comisión de gestión y el margen de seguridad del flete.</small>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-4 shadow-sm border-primary" style="position: sticky; top: 20px;">
                <h4 class="text-center fw-bold">Total Final</h4>
                <h2 class="text-center text-primary fw-bold my-3" id="total-display">Calculando...</h2>
                
                <div class="d-flex justify-content-between mb-2 small">
                    <span>Producto + Gestión:</span>
                    <span id="subtotal-txt">Cargando...</span>
                </div>
                
                <hr>

                <div id="wallet_container" class="mt-3">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
