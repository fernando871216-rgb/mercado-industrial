<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡Pago Exitoso! - Mercado Industrial</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f4f7f6; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 40px; text-align: center; max-width: 550px; background: white; }
        .checkmark { font-size: 70px; color: #28a745; margin-bottom: 15px; }
        .btn-primary { background-color: #003366; border: none; padding: 12px 30px; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .btn-primary:hover { background-color: #001f3f; transform: translateY(-2px); }
        .timer { font-size: 0.9em; color: #6c757d; margin-top: 25px; }
        .contact-box { background-color: #e8f4fd; border-radius: 10px; padding: 20px; margin: 20px 0; border: 1px dashed #009ee3; }
        .id-pago { font-size: 0.8rem; color: #a0aec0; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="checkmark">
            <i class="fas fa-check-circle"></i>
        </div>
        <h1 class="fw-bold" style="color: #003366;">¡Pago Confirmado!</h1>
        <p class="text-muted">Hemos recibido tu pago correctamente por:</p>
        <h5 class="text-dark mb-4">{{ producto.title }}</h5>
        
        <hr>

        {% if mostrar_contacto %}
        <div class="contact-box">
            <h6 class="fw-bold" style="color: #003366;"><i class="fas fa-address-book"></i> Datos del Vendedor para coordinar:</h6>
            <p class="mb-1"><strong>Nombre:</strong> {{ producto.user.get_full_name|default:producto.user.username }}</p>
            <p class="mb-1"><strong>Teléfono:</strong> {{ producto.user.profile.phone|default:"No proporcionado" }}</p>
            <p class="mb-0"><strong>Email:</strong> {{ producto.user.email }}</p>
        </div>
        {% else %}
        <p class="my-4">Tu pedido está siendo procesado. En breve podrás ver los datos de contacto en tu panel.</p>
        {% endif %}

        {% if payment_id %}
        <p class="id-pago">ID de Transacción: <strong>{{ payment_id }}</strong></p>
        {% endif %}
        
        <div class="d-grid gap-2 mt-4">
            <a href="/mis-compras/" class="btn btn-primary">VER MI COMPRA</a>
            <a href="/" style="text-decoration: none; color: #718096; font-size: 0.9rem;">Volver al inicio</a>
        </div>
        
        <p class="timer">Redirigiendo automáticamente en <span id="count" class="fw-bold">8</span> segundos...</p>
    </div>

    <script>
        // Aumentamos a 8 segundos para que alcancen a leer los datos del vendedor
        let seconds = 8;
        const display = document.getElementById('count');
        
        const countdown = setInterval(() => {
            seconds--;
            display.textContent = seconds;
            if (seconds <= 0) {
                clearInterval(countdown);
                window.location.href = "/mis-compras/";
            }
        }, 1000);
    </script>

    <script>
    // Después de 5 segundos, redirige automáticamente a Mis Compras
    setTimeout(function(){
        window.location.href = "{% url 'mis_compras' %}";
    }, 5000);
    </script>

</body>
</html>

