{% extends 'marketplace/base.html' %}

{% block content %}
<div class="container" style="max-width: 1000px; margin: 40px auto; padding: 20px; font-family: 'Segoe UI', sans-serif;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
        <h2 style="color: #2c3e50; margin: 0;">游늳 Panel de Ventas y Liquidaciones</h2>
        <div style="text-align: right;">
            <span style="color: #7f8c8d; font-size: 0.85rem; text-transform: uppercase;">Comisi칩n de Plataforma</span>
            <div style="color: #f39c12; font-weight: bold; font-size: 1.2rem;">5.0% Fijo</div>
        </div>
    </div>

    {% for venta in ventas %}
    <div style="background: #fff; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #f0f0f0; overflow: hidden;">
        <div style="display: flex; flex-wrap: wrap;">
            
            <div style="flex: 1; min-width: 300px; padding: 25px; border-right: 1px dashed #eee;">
                <span style="color: #bdc3c7; font-size: 0.8rem; font-weight: bold;">ID DE VENTA: #{{ venta.id }}</span>
                <h3 style="color: #2c3e50; margin: 10px 0; font-size: 1.5rem; text-transform: uppercase;">{{ venta.product.title }}</h3>
                
                <div style="display: flex; gap: 40px; margin-bottom: 20px;">
                    <div>
                        <span style="display: block; color: #95a5a6; font-size: 0.85rem;">Comprador</span>
                        <strong style="color: #34495e;">{{ venta.buyer.username }}</strong>
                    </div>
                    <div>
                        <span style="display: block; color: #95a5a6; font-size: 0.85rem;">Fecha de Operaci칩n</span>
                        <strong style="color: #34495e;">{{ venta.created_at|date:"d/m/Y" }}</strong>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 15px;">
                    {% if venta.status == 'pendiente' %}
                        <span style="background: #fff9db; color: #f08c00; padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-clock"></i> PENDIENTE
                        </span>
                        <a href="{% url 'cambiar_estado_venta' venta.id %}" style="color: #3498db; text-decoration: none; font-size: 0.9rem; font-weight: 500;">Cambiar estado</a>
                    {% elif venta.status == 'completado' %}
                        <span style="background: #ebfbee; color: #2b8a3e; padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: bold;">
                            <i class="fas fa-check-circle"></i> COMPLETADO
                        </span>
                    {% else %}
                        <span style="background: #fff5f5; color: #c92a2a; padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: bold;">
                            <i class="fas fa-times-circle"></i> CANCELADO
                        </span>
                    {% endif %}

                    {% if venta.status != 'cancelado' %}
                        <a href="{% url 'cancelar_venta' venta.id %}" 
                           onclick="return confirm('쯉eguro que deseas cancelar? El stock regresar치 al inventario y se anular치 el desglose financiero.')"
                           style="color: #e74c3c; text-decoration: none; font-size: 0.9rem; font-weight: 500; margin-left: auto;">
                           <i class="fas fa-trash-alt"></i> Cancelar Venta
                        </a>
                    {% endif %}
                </div>
            </div>

            <div style="flex: 1; min-width: 300px; padding: 25px; background: #fafafa;">
                <h4 style="margin: 0 0 15px 0; color: #7f8c8d; font-size: 0.9rem;">Desglose Financiero (MXN)</h4>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #34495e;">Precio de Venta:</span>
                    <span style="font-weight: bold; color: #2c3e50;">${{ venta.price }}</span>
                </div>

                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: #95a5a6; font-size: 0.9rem;">
                    <span>Costo Pasarela (3.49% + IVA + $4.64):</span>
                    <span>- ${{ venta.get_gateway_cost|default:"5.04" }}</span>
                </div>

                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: #e67e22; font-size: 0.9rem;">
                    <span>Comisi칩n INITRE (5%):</span>
                    <span>- ${{ venta.get_platform_commission|default:"0.50" }}</span>
                </div>

                <div style="border-top: 1px solid #ddd; padding-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold; color: #2c3e50; font-size: 1.1rem;">Monto Neto a Pagar:</span>
                    <span style="font-size: 1.6rem; font-weight: 800; color: #27ae60;">${{ venta.get_net_amount|default:"4.46" }}</span>
                </div>

                <div style="margin-top: 20px; background: #fff4e6; padding: 10px; border-radius: 8px; border-left: 4px solid #f39c12;">
                    <p style="margin: 0; font-size: 0.75rem; color: #856404; line-height: 1.4;">
                        <i class="fas fa-info-circle"></i> Este monto estar치 disponible para transferencia una vez que el comprador confirme la entrega f칤sica.
                    </p>
                </div>
            </div>

        </div>
    </div>
    {% empty %}
    <div style="text-align: center; padding: 80px; background: white; border-radius: 15px; color: #95a5a6;">
        <i class="fas fa-receipt" style="font-size: 4rem; opacity: 0.2; margin-bottom: 20px;"></i>
        <h3>No hay ventas registradas</h3>
        <p>Tus ventas y liquidaciones aparecer치n aqu칤 conforme recibas pedidos.</p>
    </div>
    {% endfor %}

</div>
{% endblock %}
